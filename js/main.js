// Generated by CoffeeScript 1.6.1
(function() {

  $(document).ready(function() {
    var $page_height, $window, $window_height, form_url, onScroll, pos, scroll_actions, set_pos;
    $window = $(window);
    $window_height = $window.height();
    $page_height = $(document).height();
    pos = 1;
    (set_pos = function() {
      window.requestAnimationFrame(set_pos);
      return pos = $window.scrollTop();
    })();
    $window.on("resize", function() {
      return $window_height = $window.height();
    });
    $.fn.parallax = function(rate) {
      var $this, prefix, top, update;
      $this = $(this);
      if ($this.length === 0) {
        return;
      }
      top = $this.offset().top;
      prefix = Modernizr.prefixed('transform');
      $window.on("resize", function() {
        return top = $this.offset().top;
      });
      return (update = function() {
        var next_css;
        window.requestAnimationFrame(update);
        next_css = Modernizr.csstransforms3d ? "translate3d(0, " + (Math.floor((top - pos) * rate)) + "px, 0)" : "translateY(" + ((top - pos) * rate) + "px)";
        return $this.css(prefix, next_css);
      })();
    };
    $('.background_image', 'section').each(function() {
      return $(this).parallax(-0.3);
    });
    $('.background_image', '.company_photo').parallax(0.3);
    scroll_actions = {};
    (onScroll = function() {
      return setTimeout(function() {
        var action;
        for (action in scroll_actions) {
          scroll_actions[action]();
        }
        return $window.one('scroll', onScroll);
      }, 300);
    })();
    $('input').each(function() {
      var $this, data;
      $this = $(this);
      data = $.cookie("retiring__" + ($this.attr('name')));
      if (data) {
        return $this.val(data);
      }
    });
    $('input').on("keyup change", function(e) {
      var $this;
      $this = $(this);
      return $.cookie("retiring__" + ($this.attr('name')), $this.val(), {
        expires: 1
      });
    });
    form_url = "https://docs.google.com/forms/d/1cujY_8JrgdzcwsScxv47lF_BY-g9Oz6u0vlrDNjZxGY/formResponse";
    $('#the_form').submit(function(e) {
      var data;
      e.preventDefault();
      $(this).find('input').attr('disabled', 'disabled').val("Sending...");
      data = {
        "entry.1728150349": $.cookie("retiring__age")
      };
      return $.post("ba-simple-proxy.php?url=" + form_url, data, function() {
        $.removeCookie("retiring__age");
        return console.log("Success!");
      });
    });
    if ($('body').hasClass('chapter-1-rethinking-retirement')) {
      (function() {
        var $chapter_title, $intro, $percentage_of_workers_chart, $percentage_of_workers_chart_points, $site_header, $story_header, chapter_title_top, percentage_of_workers_chart_top;
        $site_header = $('.site_header');
        $story_header = $('.story_header_wrapper');
        $chapter_title = $('.chapter_title');
        $intro = $('.intro');
        chapter_title_top = $chapter_title.offset().top;
        $percentage_of_workers_chart = $('.percentage_of_workers-chart');
        percentage_of_workers_chart_top = $percentage_of_workers_chart.offset().top;
        $percentage_of_workers_chart_points = $('.data_point', $percentage_of_workers_chart);
        scroll_actions.fade_header = function() {
          var factor, offset;
          factor = 0;
          offset = 0;
          if ($window_height > pos) {
            return $story_header.css({
              opacity: (1 + factor) * (offset + $window_height - pos) / $window_height
            });
          }
        };
        scroll_actions.shrink_header = function() {
          var pos_percent;
          pos_percent = pos / $window_height * 100;
          return $site_header.toggleClass('shown', pos_percent > 100);
        };
        scroll_actions.animate_pies = function() {
          return $intro.toggleClass("active", pos > chapter_title_top - $window_height);
        };
        return scroll_actions.show_data_points = function() {
          return $percentage_of_workers_chart_points.toggleClass('active', pos > (percentage_of_workers_chart_top - 400));
        };
      })();
    }
    if ($('body').hasClass('chapter-3-working-for-the-nest-egg')) {
      (function() {
        var $financially_unprepared_chart, $financially_unprepared_chart_points, $investor_underperforms_chart, $investor_underperforms_chart_points, financially_unprepared_chart_top, investor_underperforms_chart_top;
        $financially_unprepared_chart = $('.financially_unprepared-chart');
        financially_unprepared_chart_top = $financially_unprepared_chart.offset().top;
        $financially_unprepared_chart_points = $('.data_point', $financially_unprepared_chart);
        $investor_underperforms_chart = $('.investor_underperforms-chart');
        investor_underperforms_chart_top = $investor_underperforms_chart.offset().top;
        $investor_underperforms_chart_points = $('.data_point', $investor_underperforms_chart);
        return scroll_actions.show_data_points = function() {
          return $financially_unprepared_chart_points.toggleClass('active', pos > (financially_unprepared_chart_top - 400));
        };
      })();
    }
    if ($('body').hasClass('chapter-4-working-in-retirement')) {
      (function() {
        var $how_long_work, $user_age, set_how_long_work;
        $user_age = $('.user_age');
        $how_long_work = $('.how_long_work');
        (set_how_long_work = function() {
          var age;
          age = $user_age.val();
          return $how_long_work.toggleClass('show_over_65', age >= 65);
        })();
        return $user_age.on("keyup change", set_how_long_work);
      })();
    }
    $('#credits-open').on("click", function() {
      return $('#credits').show();
    });
    return $('#credits-close').on("click", function(e) {
      e.preventDefault();
      return $('#credits').hide();
    });
  });

}).call(this);
